---
import { fetchTestimonialsPage } from "../lib/wordpress";
import { parseTestimonials } from "../lib/testimonials";
import Testimonial from "../components/Testimonial.astro";
import Logo from "./Logo.astro";
import Logos from "./Logos.astro";
import ExampleLogo from "../../src/images/logoipsum.svg";

const pageContent = await fetchTestimonialsPage();
const testimonials = pageContent ? parseTestimonials(pageContent) : [];

// Determine the layout class based on the number of testimonials
const layoutClass =
  testimonials.length === 1
    ? "grid grid-cols-1"
    : testimonials.length === 2
      ? "grid grid-cols-1 md:grid-cols-2"
      : "flex overflow-x-auto snap-x snap-mandatory scrollbar-hide";

// Determine the item class based on the number of testimonials
const itemClass =
  testimonials.length <= 2
    ? "w-full"
    : "flex-none w-full md:w-1/2 lg:w-1/3 snap-start";
---

<section>
  <Logos title="Previous clients">
    <Logo org="Logo Ipsum" src={ExampleLogo} url="https://loremipsum.com" />
    <Logo org="Logo Ipsum" src={ExampleLogo} url="https://loremipsum.com" />
    <Logo org="Logo Ipsum" src={ExampleLogo} url="https://loremipsum.com" />
    <Logo org="Logo Ipsum" src={ExampleLogo} url="https://loremipsum.com" />
    <Logo org="Logo Ipsum" src={ExampleLogo} url="https://loremipsum.com" />
    <Logo org="Logo Ipsum" src={ExampleLogo} url="https://loremipsum.com" />
  </Logos>
  <div
    class={`w-full overflow-hidden py-5 ${testimonials.length > 2 ? "overflow-x-auto" : ""}`}
  >
    <div class={layoutClass}>
      {
        testimonials.map((testimonial, index) => (
          <div class={`${itemClass} px-2.5`}>
            <Testimonial
              background={index % 2 === 0}
              author={testimonial.author}
              quote={testimonial.quote}
              role={testimonial.role}
              link={testimonial.link}
              org={testimonial.org}
            />
          </div>
        ))
      }
    </div>
  </div>
</section>
