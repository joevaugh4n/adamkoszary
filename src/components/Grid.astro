---
import { Image } from "astro:assets";
import { fetchPageBySlug } from "../lib/wordpress";
import H2 from "./H2.astro";

interface Props {
  /** The section title, e.g. 'Principles, What I Do'. Renders in uppercase. */
  title: string;
  /** The section hero image. */
  image?: ImageMetadata | undefined;
  /** Section hero image alt text. */
  alt?: string | undefined;
  /** Do you want a background colour? */
  background?: boolean;
  /** If section appears at the top of the page, use 'eager'. Else, use 'lazy' or simply ignore to set lazy loading automatically. */
  loading?: "eager" | "lazy";
  /** Slug for WordPress page. For example: 'principles' would load content from 'https://test113736.wordpress.com/principles/' */
  slug?: string;
  // Whether the image or text should appear first
  order?: "image-first" | "text-first";
}

const {
  title,
  image,
  alt,
  background,
  loading = "lazy",
  slug,
  order = "image-first",
} = Astro.props;

let content;
if (slug) {
  const page = await fetchPageBySlug(slug);
  content = page ? page.content.rendered : null;
}
---

<section
  id="services"
  class={`${image ? "grid md:grid-cols-2" : "md:flex md:justify-center"} py-8 gap-x-16 gap-y-6 border-b-2 ${
    background && "bg-slate-100 px-4"
  }`}
>
  <div
    class={`image-container ${order === "text-first" ? "md:order-last" : ""}`}
  >
    {
      image && alt && (
        <Image
          class="w-full rounded-sm"
          alt={alt}
          src={image}
          loading={loading}
        />
      )
    }
  </div>

  <article
    class={`${order === "text-first" ? "md:order-first" : ""} ${background ? "dark:text-black" : "text-black dark:text-white"}`}
  >
    <H2 title={title}/>
    <div
      class={`prose dark:prose-invert text-pretty prose-p:leading-loose prose-p:mt-0 prose-p:mb-2 prose-ul:m-0 ${background ? "dark:text-black" : "text-black dark:text-white"}`}
    >
      {content ? <div set:html={content} /> : <slot />}
    </div>
  </article>
</section>

<style>
  @media (max-width: 768px) {
    .image-container,
    article {
      order: initial !important;
    }
  }
</style>
